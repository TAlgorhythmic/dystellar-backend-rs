CREATE TABLE IF NOT EXISTS groups
(
	id INTEGER PRIMARY KEY NOT NULL,
	name VARCHAR(32) NOT NULL UNIQUE,
	prefix VARCHAR(16) NOT NULL DEFAULT "",
	suffix VARCHAR(16) NOT NULL DEFAULT "",
	lastModification DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS nm_permissions
(
	group_id INTEGER NOT NULL,
	permission_id INTEGER NOT NULL,
	value BOOLEAN NOT NULL DEFAULT TRUE,
	UNIQUE(group_id, permission_id),
	FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE,
	FOREIGN KEY(permission_id) REFERENCES permissions(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS permissions
(
	id INTEGER PRIMARY KEY NOT NULL,
	permission VARCHAR(80) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS players
(
    uuid CHAR(36) NOT NULL,
	name VARCHAR(16),
	email VARCHAR(80),
	pwhash CHAR(128),
	salt CHAR(64),
    chat BOOLEAN NOT NULL DEFAULT TRUE,
    pms INTEGER NOT NULL DEFAULT 1,
    suffix VARCHAR(16) NOT NULL DEFAULT "",
    lang CHAR(2) NOT NULL DEFAULT "en",
    scoreboard BOOLEAN NOT NULL DEFAULT TRUE,
	friendReqs BOOLEAN NOT NULL DEFAULT TRUE,
	sendPackPrompt BOOLEAN NOT NULL DEFAULT TRUE,
	tipFirstFriend BOOLEAN NOT NULL DEFAULT FALSE,
	creationDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	coins BIGINT NOT NULL DEFAULT 0,
	group INTEGER,
    PRIMARY KEY (uuid),
	FOREIGN KEY (group) REFERENCES groups(id) ON DELETE SET NULL
);
CREATE INDEX IF NOT EXISTS idx_name ON players(name);
CREATE TABLE IF NOT EXISTS friends
(
	player1 CHAR(36) NOT NULL,
	player2 CHAR(36) NOT NULL,
	PRIMARY KEY (player1, player2),
	FOREIGN KEY (player1) REFERENCES players(uuid) ON DELETE CASCADE,
	FOREIGN KEY (player2) REFERENCES players(uuid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS ignores
(
	ignored CHAR(36) NOT NULL,
	issuer CHAR(36) NOT NULL,
	PRIMARY KEY (issuer, ignored),
	FOREIGN KEY (issuer) REFERENCES players(uuid) ON DELETE CASCADE,
	FOREIGN KEY (ignored) REFERENCES players(uuid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS punishments
(
	id INTEGER PRIMARY KEY NOT NULL,
	reason VARCHAR(255) NOT NULL DEFAULT "Unspecified",
	creationDate DATETIME NOT NULL,
	expirationDate DATETIME,
	type INTEGER NOT NULL,
	player CHAR(36) NOT NULL,
	ip INT NOT NULL,
	alsoip BOOLEAN NOT NULL,
	FOREIGN KEY (player) REFERENCES players(uuid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS notes
(
	id INTEGER PRIMARY KEY NOT NULL,
	note VARCHAR(255) NOT NULL,
	player CHAR(36) NOT NULL,
	FOREIGN KEY (player) REFERENCES players(uuid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS inboxes
(
	id INTEGER PRIMARY NOT NULL,
	submissionDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	player CHAR(36) NOT NULL,
	FOREIGN KEY (player) REFERENCES players(uuid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS inbox_global_messages
(
    id INTEGER NOT NULL,
	issuer TEXT NOT NULL,
	title TEXT NOT NULL,
	msg TEXT NOT NULL,
	action TEXT NOT NULL,
	type INTEGER NOT NULL,
	data TEXT NOT NULL,
	creationDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
);
